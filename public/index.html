<!doctype html>
<html>
  <head>
    <title>Example of the Authorization Code flow with Spotify</title>
    <script src="spotify-web-api.js"></script>
  </head>
  <body>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script>
      var access_token;
      var device_id;
      (async function() {

        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */
        function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }

        var params = getHashParams();

        var songs = [ { id: '5sra5UY6sD658OabHL3QtI', start: '166626', end: '1000' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' },
  { id: '2Xqd0wUttjueBfdcltADOv', start: '12680', end: '-181' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '25033', end: '1000' },
  { id: '52IuMfbQa9aqRPz2oYPAI8', start: '13713', end: '321' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '25033', end: '1000' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '10466', end: '387' },
  { id: '5NFYuqu8V6QXc6mzcLImd6', start: '103670', end: '1000' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' },
  { id: '5SE57ljOIUJ1ybL9U6CuBH', start: '90033', end: '1000' },
  { id: '2fQrGHiQOvpL9UgPvtYy6G', start: '14280', end: '1000' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '9066', end: '390' },
  { id: '3A2waEDfZQfl6RNOn8Y1xW', start: '161780', end: '683' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '94533', end: '208' },
  { id: '3XVozq1aeqsJwpXrEZrDJ9', start: '48560', end: '1000' },
  { id: '0pSBuHjILhNEo55xK1zrRt', start: '65120', end: '199' },
  { id: '6AGON2BGdPmPMJGiiNuuwl', start: '11940', end: '172' },
  { id: '7KXjTSCq5nL1LoYtL7XAwS', start: '47100', end: '433' },
  { id: '45XhKYRRkyeqoW3teSOkCM', start: '1000', end: '1000' } ];

        access_token = "BQDD5fGnbn4tinX9u8oy8pVRtxZE4TINzNoNlQ8rNHy6BK2qvii3n9uRfDWXeOEH-k4eK7HVs-lA4SG0Pn5lrEKZVOk9hEMgTBD5v7rGa6PrCTl8GzsXv8r9ybvbjpcmCfnblzu_Bjkwan4vZEcwR3Y5axdziTiiZhkBi-PdidHgE1Y2Iys2vIG9RwVJSJoeNta-ptYVU8GxyKxwGTOgmntegap4rvhFZlaSEr858RA9BTC-yxddqddn0ESlzy4HZaKeoyexHYMqCPQTm_DP_aTZD6PUK1CRz9BhfFN1dh8LgVZ7Ba-7SnPKqg4u3lHukw";
        device_id = "028544928f36409f9fea78fc410396306b81dc08";

        var spotifyApi = new SpotifyWebApi();

        spotifyApi.setAccessToken(access_token);

        for (var i = 0; i < songs.length; i++) {
          var element = songs[i];
          console.log(element.id);

          setSong(element.id)
          await sleep(800)
          seekSong(element.start)
          var timeout = parseInt(element.end) >= 0 ? parseInt(element.end) : 500
          await sleep(2000 + timeout)
        }

        spotifyApi.pause({"device_id": device_id});
      })();

      function setSong(id) {
        $.ajax({
          url: 'https://api.spotify.com/v1/me/player/play?device_id=' + device_id,
          data: '{"uris": ["spotify:track:' + id + '"]}',
          type: 'PUT',
          beforeSend: function(xhr) {
              xhr.setRequestHeader("Authorization", "Bearer " + access_token);
              xhr.setRequestHeader("Content-Type", "application/json");
          }
        })
      }

      function seekSong(time) {
        $.ajax({
          url: 'https://api.spotify.com/v1/me/player/seek?position_ms=' + time + '&device_id=' + device_id,
          type: 'PUT',
          beforeSend: function(xhr) {
              xhr.setRequestHeader("Authorization", "Bearer " + access_token);
          }
        })
      }

      function sleep(milliseconds) {
        return new Promise(resolve => setTimeout(resolve, milliseconds));
      }
    </script>
  </body>
</html>
